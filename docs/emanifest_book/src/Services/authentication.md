# Authentication

## Pre-requisites

Users looking to use the RCRAInfo API need to register and obtain the necessary permissions for the site they're looking
to operate as. For infomation on regsitration and permission levels, see the chanpter
on [registration](../Intro/registration.md).

## API ID and Keys

The system uses a combination of API ID and API key for user authentication and authorization. The API ID and key (
credentials) are generated by the RCRAInfo/e-Manifest application. An API ID/key pair is unique to a user, however the
same API ID/key pair is used for all EPA sites that the user has (Site Manager) access to.

[Site Managers](../Intro/registration.md#permission-levels) are the only permission level that can generate API
credentials in RCRAInfo. API ID/key pairs do not expire, however, RCRAInfo application passwords (the password used to
log into RCRAInfo through a browser) expire every 90 days. The Site Manager that owns the API ID/API key pair must
properly maintain account.

User can regenerator new API keys if their key is lost, is compromised, or need to be rotated. An API ID/key pair is
terminated is the user account is deactivated or no longer has Site Manager level access for any EPA site. API ID are
static.

## Security Tokens

All services (except [Authenticate](#authenticate-service)) require a security.
To obtain a security token, users must utilize the [Authentication (auth)](#authenticate-service) service, which returns
a JSON Web Token (JWT) and an expiration date. All subsequent requests must include the JWT as an HTTP header under
the `Authorization` key with a value of `Bearer` plus the provided security token.

For example, an HTTP requiest to the [federal-waste-codes]() endpoint would include...

```http
GET /api/v1/federal-waste-codes HTTP/1.1
Host: rcrainfo.epa.gov
Authorization: Bearer theSecurityTokenObtainedFromTheAuthEndpoint
Accept: application/json
...
```

### Expirations and Refreshing Tokens

Security tokens expire after 20 minutes. The expiration time is included in the response from
the [Authenticate service](#authenticate-service). Currently, RCRAinfo does not provide refresh tokens or a method to
obtain a new tokens without performing a complete login (i.e., using
the [Authentication Service](#authenticate-service)).

Expiration datetime follows the ISO 8601 profile, the international standard for representing dates and times. Times are
expressed in Coordinated Universal Time (UTC) using
the [time zone offset designator ("+hh:mm")](https://www.w3.org/TR/NOTE-datetime) down to the millisecond.

```json
{
  "expiration": "2023-05-10T19:10:05.923+00:00",
  "exprFormat": "YYYY-MM-DDThh:mm:ss.sTZD"
}
```

## Authenticate Service

Authenticates the user and returns the Security Token. The Security token is used on all subsequent calls and is
submitted in the HTTP header using the Authorization in the Key with a value of Bearer

### parameters

- API ID: API ID generated through the RCRAInfo web application. This is not the user's username.
- API key: API key generated through the RCRAInfo web application. Keys can be regenerated when necessary.

### Service Invocation Example

The URL follows this pattern
`<Production or Pre-Production domain>/rest/api/v1/auth/<api ID>/<API key>`

```java
/**
 * Main.java
 * makes a request to the Pre-production Auth endpoint and prints the response to std out
 * JDK 19
 */
package org.example;

import java.net.URI;
import java.net.http.HttpClient;
import java.net.http.HttpRequest;
import java.net.http.HttpResponse;

public class Main {
    public static void main(String[] args) {
        String baseURL = "https://rcrainfopreprod.epa.gov/rcrainfo/rest/api/v1/auth/";
        HttpClient client = HttpClient.newHttpClient();
        HttpRequest request = HttpRequest.newBuilder()
                .uri(URI.create(baseURL + "/" + "myApiId" + "/" + "apiKey"))
                .build();
        client.sendAsync(request, HttpResponse.BodyHandlers.ofString())
                .thenApply(HttpResponse::body)
                .thenAccept(System.out::println)
                .join();
    }
}
```

### Response Body Example

```json
{
  "token": "eyJhbGciOiJIUzUxMiJ9.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_PGyN6for1GHwf6zqp0OJS10hwK8jEgRyRI0JpFUducwDKj5paWRTEsCky_06pryEve3Yw2w1bbBzqGdSnnw",
  "expiration": "2017-06-23T23:15:45.095+0000"
}
```
