# Manifest Retrieve Service

Returns the Manifest’s latest version data associated with the provided Manifest Tracking Number. The service always
returns Manifest data and optionally returns Manifest attachments. For the “Image” manifests submitted via mail the
service will return the manifest version according to the following rules:

- If PPC status of the latest manifest version is either `PendingDataEntry` or `DataQaCompleted` this version will be
  returned by the service.
- If PPC status of the latest manifest version is either `Draft` or `DataEntryInProgress` or `PendingDataQc`
  or `PendingDataQa` the manifest version will not be returned.

For the `Image` manifests submitted by industry the service will return the latest version of the manifest which has
either manifest status `ReadyForSignature`, `Signed` or `Corrected` and PPC status `PendingDataEntry`
or `DataQaCompleted`

If the Manifest contains an attachment(s) and the attachment option is specified, the following documents will be
returned:

- PDF Document containing printed, scanned, and manually signed Manifest form (Printed Document). Note that this
  document is not available for `FullElectronic` or `Hybrid` submission types.

- HTML Document(s) containing human-readable representation of the Manifest data signed electronically - Copy Of Record
  document (COR). Note that the system generates this Document(s) at the time when the users (Generator, Transporters,
  TSDF) are electronically signing the manifest. In order to identify what party the COR document was generated by, the
  following naming convention is used:

  - COR document generated when Generator signed the manifest : `<cor-g.html>`
  - COR document generated when Generator signed the manifest for rejection (If shipment was returned back to the
    original Generator): `<cor-g-reject.html>`
  - COR document generated when Transporter(s) signed the manifest: `<cor-t-{transporter order}.html>`
  - COR document generated when TSDF signed the manifest: `<cor-tsdf.html>`

- PDF Document containing form 8700-22 representation of the Manifest Data. Following document metadata JSON elements
  will be presented in Manifest JSON if the Manifest
  contains attachments:

  - Printed Document metadata example:
    ```json
    {
      "printedDocument": {
        "name": "user provided document name.pdf",
        "size": 500,
        "mimeType": "APPLICATION_PDF"
      }
    }
    ```
  - COR Document (Human Readable Document) signed by TSDF metadata example:
    ```json
    {
      "humanReadableDocument": {
        "name": "cor-tsdf.html",
        "size": 500,
        "mimeType": "TEXT_HTML"
      }
    }
    ```
  - Form 2050 Document metadata example:

    ```json
    {
      "formDocument": {
        "name": "form-8700-22.pdf",
        "size": 7000,
        "mimeType": "APPLICATION_PDF"
      }
    }
    ```

    All documents will zipped and zip file will be returned as a multipart binary content. See our documentation
    on [manifest attachments](./manifest-attachments.md) for more information.

## Parameters

- [Security Token](../authentication.md#security-tokens)
- Manifest Tracking Number

### Example

Retrieve manifest without attachments:

```http
GET /rcrainfo/rest/api/v1/emanifest/manifest/123456789ELC HTTP/1.1
Host: rcrainfopreprod.epa.gov
Authorization: Bearer theSecurityTokenObtainedFromTheAuthService
Accept: application/json

```

Retrieve manifest with attachments:

```http
GET /rcrainfo/rest/api/v1/emanifest/manifest/123456789ELC/attachments HTTP/1.1
Host: rcrainfopreprod.epa.gov
Authorization: Bearer theSecurityTokenObtainedFromTheAuthService
Accept: multipart/mixed

```

See {{#include ../../components/manifest-json-link.md}}

## Sequence of Steps

1. [Security Token Validation](../authentication.md#security-token-validation).
2. [User Authorization](../authentication.md#user-authorization).
3. The system will process the request

   - 3.1. The system will check if the provided Manifest Tracking Number is valid and in the system.
     - 3.1.1. Manifest Tracking Number shall be compliant with following rules:
       - Nine numeric characters + valid three-character Manifest Tracking Suffix.
     - 3.1.2. If provided Manifest Tracking Number does not have valid format, the processing
       will be stopped and the system will generate the following error:
       - `E_InvalidManifestTrackingNumber: Provided Manifest Tracking Number has an invalid format.`
     - 3.1.3. If Manifest with provided Manifest Tracking Number is not in the system, the
       processing will be stopped, and the system will generate the following error:
       - `E_ManifestTrackingNumberNotFound: Provided Manifest Tracking Number was not found`
   - 3.2. The system will obtain the Manifest for the provided Manifest Tracking Number.
   - 3.3. The system will check if the user has Industry Permissions for the Generator Site ID or TSDF Site ID provided
     on the manifest.
   - 3.4. If the User does not have permission, the System will stop the processing and will generate
     the following error:
     - `E_SitePermissions: The user does not have Industry Permissions for the Generator Site or TSDF Site`
   - 3.5. The System generates JSON containing obtained Manifest

4. On success, the system returns the following response:

   - generated JSON containing obtained Manifest
   - if the attachment endpoint was used and manifest contains attachments, all or some following documents will be
     zipped and returned as a multipart binary content:
     - Printed Document
     - COR document(s)
     - Form 2050

5. If any system errors were encountered during processing, the system will return:

   - error: containing error code, error message, error id, and error date
